var e,t;(e=window.document).getElementById("livereloadscript")||((t=e.createElement("script")).async=1,t.src="//"+(window.location.host||"localhost").split(":")[0]+":35729/livereload.js?snipver=1",t.id="livereloadscript",e.getElementsByTagName("head")[0].appendChild(t));class i{constructor(e){if(this.options={quality:.9,scale:1,interval:1,startTime:0},this.thumbnails=[],!e)throw new Error("video url required");this.videoElement=document.createElement("video"),this.canvas=document.createElement("canvas");const t=this.canvas.getContext("2d");if(!t)throw new Error("Could not create canvas context");this.canvasContext=t,this.videoElement.src=e,this.videoElement.crossOrigin="anonymous"}async getThumbnail(e,t={}){4!==this.videoElement.readyState&&await this.waitVideoLoaded(),t=Object.assign(this.options,t);const{scale:i,quality:a}=t;return this.canvas.width=this.videoElement.videoWidth*(i||1),this.canvas.height=this.videoElement.videoHeight*(i||1),await this.getFrameImage(e,a)}async getThumbnails(e={}){4!==this.videoElement.readyState&&await this.waitVideoLoaded(),e=Object.assign(this.options,e);const{interval:t,scale:i,quality:a}=e;this.canvas.width=this.videoElement.videoWidth*(i||1),this.canvas.height=this.videoElement.videoHeight*(i||1);const s=this.videoElement.duration/(t||1);for(let e=0;e<s;e++){const i=await this.getFrameImage(t*e,a);this.thumbnails.push({currentTime:t*e,url:i})}return this.thumbnails}canvasToBlob(e,t){return new Promise((i=>{if(e.toBlob)e.toBlob((e=>i(URL.createObjectURL(e))),"image/jpeg",t);else{const a=atob(e.toDataURL("image/jpeg",t).split(",")[1]),s=a.length,n=new Uint8Array(s);for(let e=0;e<s;e++)n[e]=a.charCodeAt(e);const o=new Blob([n],{type:"image/jpeg"});i(URL.createObjectURL(o))}}))}async getFrameImage(e,t){return await this.seekVideo(e),this.canvasContext.clearRect(0,0,this.canvas.width,this.canvas.height),this.canvasContext.drawImage(this.videoElement,0,0,this.canvas.width,this.canvas.height),this.canvasToBlob(this.canvas,t)}waitVideoLoaded(e=10){return new Promise(((t,i)=>{const a=()=>{n(),t()},s=()=>{n(),i("video load error")},n=()=>{this.videoElement.removeEventListener("loadedmetadata",a),this.videoElement.removeEventListener("error",s)};this.videoElement.addEventListener("loadedmetadata",a),this.videoElement.addEventListener("error",s),e&&setTimeout(s,1e3*e)}))}seekVideo(e){return new Promise((t=>{const i=()=>{this.videoElement.removeEventListener("seeked",i),t()};this.videoElement.addEventListener("seeked",i),this.videoElement.currentTime=e}))}}export{i as VideoThumbnail};
//# sourceMappingURL=index.es.js.map
